# Cryostat Helm Chart
A Helm chart for deploying [Cryostat](https://cryostat.io/) on Kubernetes and OpenShift

## Parameters

### Cryostat Container

| Name                                           | Description                                                                                                                                                                                                                                                                                                    | Value                       |
| ---------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------- |
| `core`                                         | Configuration for the core Cryostat application                                                                                                                                                                                                                                                                |                             |
| `core.image.repository`                        | Repository for the main Cryostat container image                                                                                                                                                                                                                                                               | `quay.io/cryostat/cryostat` |
| `core.image.pullPolicy`                        | Image pull policy for the main Cryostat container image                                                                                                                                                                                                                                                        | `Always`                    |
| `core.image.tag`                               | Tag for the main Cryostat container image                                                                                                                                                                                                                                                                      | `3.0.0-snapshot`            |
| `core.service.type`                            | Type of Service to create for the Cryostat application                                                                                                                                                                                                                                                         | `ClusterIP`                 |
| `core.service.httpPort`                        | Port number to expose on the Service for Cryostat's HTTP server                                                                                                                                                                                                                                                | `8181`                      |
| `core.service.jmxPort`                         | Port number to expose on the Service for remote JMX connections to Cryostat                                                                                                                                                                                                                                    | `9091`                      |
| `core.sslProxied`                              | Enables SSL Proxied Environment Variables, useful when you are offloading SSL/TLS at External Loadbalancer instead of Ingress                                                                                                                                                                                  | `false`                     |
| `core.ingress.enabled`                         | Whether to create an Ingress object for the Cryostat service                                                                                                                                                                                                                                                   | `false`                     |
| `core.ingress.className`                       | Ingress class name for the Cryostat application Ingress                                                                                                                                                                                                                                                        | `""`                        |
| `core.ingress.annotations`                     | Annotations to apply to the Cryostat application Ingress                                                                                                                                                                                                                                                       | `{}`                        |
| `core.ingress.hosts`                           | Hosts to create rules for in the Cryostat application Ingress. See: [IngressSpec](https://kubernetes.io/docs/reference/kubernetes-api/service-resources/ingress-v1/#IngressSpec)                                                                                                                               | `[]`                        |
| `core.ingress.tls`                             | TLS configuration for the Cryostat application Ingress. See: [IngressSpec](https://kubernetes.io/docs/reference/kubernetes-api/service-resources/ingress-v1/#IngressSpec)                                                                                                                                      | `[]`                        |
| `core.route.enabled`                           | Whether to create a Route object for the Cryostat service. Available only on OpenShift                                                                                                                                                                                                                         | `false`                     |
| `core.route.tls.enabled`                       | Whether to secure the Cryostat application Route with TLS. See: [TLSConfig](https://docs.openshift.com/container-platform/4.10/rest_api/network_apis/route-route-openshift-io-v1.html#spec-tls)                                                                                                                | `true`                      |
| `core.route.tls.termination`                   | Type of TLS termination to use for the Cryostat application Route. One of: `edge`, `passthrough`, `reencrypt`                                                                                                                                                                                                  | `edge`                      |
| `core.route.tls.insecureEdgeTerminationPolicy` | Specify how to handle insecure traffic for the Cryostat application Route. One of: `Allow`, `Disable`, `Redirect`                                                                                                                                                                                              | `Redirect`                  |
| `core.route.tls.key`                           | Custom private key to use when securing the Cryostat application Route                                                                                                                                                                                                                                         | `""`                        |
| `core.route.tls.certificate`                   | Custom certificate to use when securing the Cryostat application Route                                                                                                                                                                                                                                         | `""`                        |
| `core.route.tls.caCertificate`                 | Custom CA certificate to use, if needed to complete the certificate chain, when securing the Cryostat application Route                                                                                                                                                                                        | `""`                        |
| `core.route.tls.destinationCACertificate`      | Provides the contents of the CA certificate of the final destination when using reencrypt termination for the Cryostat application Route                                                                                                                                                                       | `""`                        |
| `core.resources`                               | Resource requests/limits for the Cryostat container. See: [ResourceRequirements](https://kubernetes.io/docs/reference/kubernetes-api/workload-resources/pod-v1/#resources)                                                                                                                                     | `{}`                        |
| `core.securityContext`                         | Security Context for the Cryostat container. Defaults to meet "restricted" [Pod Security Standard](https://kubernetes.io/docs/concepts/security/pod-security-standards/#restricted). See: [SecurityContext](https://kubernetes.io/docs/reference/kubernetes-api/workload-resources/pod-v1/#security-context-1) | `{}`                        |
| `core.databaseSecretName`                      | Name of the secret to extract password for credentials database.                                                                                                                                                                                                                                               | `""`                        |


### Database Container

| Name                  | Description                                                                                                                                                                                                                                                                                                    | Value                          |
| --------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------ |
| `Configuration`       | for Cryostat's database                                                                                                                                                                                                                                                                                        |                                |
| `db.image.repository` | Repository for the database container image                                                                                                                                                                                                                                                                    | `quay.io/cryostat/cryostat-db` |
| `db.image.pullPolicy` | Image pull policy for the database container image                                                                                                                                                                                                                                                             | `Always`                       |
| `db.image.tag`        | Tag for the database container image                                                                                                                                                                                                                                                                           | `latest`                       |
| `db.resources`        | Resource requests/limits for the database container. See: [ResourceRequirements](https://kubernetes.io/docs/reference/kubernetes-api/workload-resources/pod-v1/#resources)                                                                                                                                     | `{}`                           |
| `db.securityContext`  | Security Context for the database container. Defaults to meet "restricted" [Pod Security Standard](https://kubernetes.io/docs/concepts/security/pod-security-standards/#restricted). See: [SecurityContext](https://kubernetes.io/docs/reference/kubernetes-api/workload-resources/pod-v1/#security-context-1) | `{}`                           |


### Storage Container

| Name                       | Description                                                                                                                                                                                                                                                                                                   | Value                               |
| -------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------- |
| `Configuration`            | for Cryostat's object storage provider                                                                                                                                                                                                                                                                        |                                     |
| `storage.image.repository` | Repository for the storage container image                                                                                                                                                                                                                                                                    | `quay.io/cryostat/cryostat-storage` |
| `storage.image.pullPolicy` | Image pull policy for the storage container image                                                                                                                                                                                                                                                             | `Always`                            |
| `storage.image.tag`        | Tag for the storage container image                                                                                                                                                                                                                                                                           | `latest`                            |
| `storage.resources`        | Resource requests/limits for the storage container. See: [ResourceRequirements](https://kubernetes.io/docs/reference/kubernetes-api/workload-resources/pod-v1/#resources)                                                                                                                                     | `{}`                                |
| `storage.securityContext`  | Security Context for the storage container. Defaults to meet "restricted" [Pod Security Standard](https://kubernetes.io/docs/concepts/security/pod-security-standards/#restricted). See: [SecurityContext](https://kubernetes.io/docs/reference/kubernetes-api/workload-resources/pod-v1/#security-context-1) | `{}`                                |


### Grafana Container

| Name                       | Description                                                                                                                                                                                                                                                                                                   | Value                                         |
| -------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------- |
| `grafana`                  | Configuration for the customized Grafana instance for Cryostat                                                                                                                                                                                                                                                |                                               |
| `grafana.image.repository` | Repository for the Grafana container image                                                                                                                                                                                                                                                                    | `quay.io/cryostat/cryostat-grafana-dashboard` |
| `grafana.image.pullPolicy` | Image pull policy for the Grafana container image                                                                                                                                                                                                                                                             | `Always`                                      |
| `grafana.image.tag`        | Tag for the Grafana container image                                                                                                                                                                                                                                                                           | `latest`                                      |
| `grafana.service.type`     | Type of Service to create for Grafana                                                                                                                                                                                                                                                                         | `ClusterIP`                                   |
| `grafana.service.port`     | Port number to expose on the Service for Grafana's HTTP server                                                                                                                                                                                                                                                | `3000`                                        |
| `grafana.resources`        | Resource requests/limits for the Grafana container. See: [ResourceRequirements](https://kubernetes.io/docs/reference/kubernetes-api/workload-resources/pod-v1/#resources)                                                                                                                                     | `{}`                                          |
| `grafana.securityContext`  | Security Context for the Grafana container. Defaults to meet "restricted" [Pod Security Standard](https://kubernetes.io/docs/concepts/security/pod-security-standards/#restricted). See: [SecurityContext](https://kubernetes.io/docs/reference/kubernetes-api/workload-resources/pod-v1/#security-context-1) | `{}`                                          |


### JFR Data Source Container

| Name                          | Description                                                                                                                                                                                                                                                                                                           | Value                             |
| ----------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------- |
| `datasource`                  | Configuration for the JFR Data Source component, which translates recording events into a format consumable by Grafana                                                                                                                                                                                                |                                   |
| `datasource.image.repository` | Repository for the JFR Data Source container image                                                                                                                                                                                                                                                                    | `quay.io/cryostat/jfr-datasource` |
| `datasource.image.pullPolicy` | Image pull policy for the JFR Data Source container image                                                                                                                                                                                                                                                             | `Always`                          |
| `datasource.image.tag`        | Tag for the JFR Data Source container image                                                                                                                                                                                                                                                                           | `latest`                          |
| `datasource.resources`        | Resource requests/limits for the JFR Data Source container. See: [ResourceRequirements](https://kubernetes.io/docs/reference/kubernetes-api/workload-resources/pod-v1/#resources)                                                                                                                                     | `{}`                              |
| `datasource.securityContext`  | Security Context for the JFR Data Source container. Defaults to meet "restricted" [Pod Security Standard](https://kubernetes.io/docs/concepts/security/pod-security-standards/#restricted). See: [SecurityContext](https://kubernetes.io/docs/reference/kubernetes-api/workload-resources/pod-v1/#security-context-1) | `{}`                              |


### Authentication

| Name                                  | Description                                                                                                                                                                                                                                                                                                                                               | Value   |
| ------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------- |
| `authentication.basicAuth.enabled`    | Whether Cryostat should use basic authentication for users. When false, Cryostat will not perform any form of authentication                                                                                                                                                                                                                              | `false` |
| `authentication.basicAuth.secretName` | Name of the Secret that contains the credentials within Cryostat's namespace **(Required if basicAuth is enabled)**                                                                                                                                                                                                                                       | `""`    |
| `authentication.basicAuth.filename`   | Key within Secret containing the `htpasswd` file. The file should contain one user definition entry per line, with the syntax "user:passHash", where "user" is the username and "passHash" is the `bcrypt` hash of the desired password. Such an entry can be generated with ex. `htpasswd -nbB username password` **(Required if basicAuth is enabled)** | `""`    |


### OAuth2 Proxy

| Name                           | Description                                                                                                                                                                                                                                                                                                        | Value                               |
| ------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ----------------------------------- |
| `oauth2Proxy.image.repository` | Repository for the OAuth2 Proxy container image                                                                                                                                                                                                                                                                    | `quay.io/oauth2-proxy/oauth2-proxy` |
| `oauth2Proxy.image.pullPolicy` | Image pull policy for the OAuth2 Proxy container image                                                                                                                                                                                                                                                             | `Always`                            |
| `oauth2Proxy.image.tag`        | Tag for the OAuth2 Proxy container image                                                                                                                                                                                                                                                                           | `latest`                            |
| `oauth2proxy.securityContext`  | Security Context for the OAuth2 Proxy container. Defaults to meet "restricted" [Pod Security Standard](https://kubernetes.io/docs/concepts/security/pod-security-standards/#restricted). See: [SecurityContext](https://kubernetes.io/docs/reference/kubernetes-api/workload-resources/pod-v1/#security-context-1) | `{}`                                |


### Other Parameters

| Name                         | Description                                                                                                                                                                                                                                                                                               | Value               |
| ---------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------- |
| `imagePullSecrets`           | Image pull secrets to be used for the Cryostat deployment                                                                                                                                                                                                                                                 | `[]`                |
| `nameOverride`               | Overrides the name of this Chart                                                                                                                                                                                                                                                                          | `""`                |
| `fullnameOverride`           | Overrides the fully qualified application name of `[release name]-[chart name]`                                                                                                                                                                                                                           | `""`                |
| `rbac.create`                | Specifies whether RBAC resources should be created                                                                                                                                                                                                                                                        | `true`              |
| `serviceAccount.create`      | Specifies whether a service account should be created                                                                                                                                                                                                                                                     | `true`              |
| `serviceAccount.annotations` | Annotations to add to the service account                                                                                                                                                                                                                                                                 | `{}`                |
| `serviceAccount.name`        | The name of the service account to use. If not set and create is true, a name is generated using the fullname template                                                                                                                                                                                    | `""`                |
| `podAnnotations`             | Annotations to be applied to the Cryostat Pod                                                                                                                                                                                                                                                             | `{}`                |
| `podSecurityContext`         | Security Context for the Cryostat Pod. Defaults to meet "restricted" [Pod Security Standard](https://kubernetes.io/docs/concepts/security/pod-security-standards/#restricted). See: [PodSecurityContext](https://kubernetes.io/docs/reference/kubernetes-api/workload-resources/pod-v1/#security-context) | `{}`                |
| `nodeSelector`               | Node Selector for the Cryostat Pod. See: [NodeSelector](https://kubernetes.io/docs/reference/kubernetes-api/workload-resources/pod-v1/#scheduling)                                                                                                                                                        | `{}`                |
| `tolerations`                | Tolerations for the Cryostat Pod. See: [Tolerations](https://kubernetes.io/docs/reference/kubernetes-api/workload-resources/pod-v1/#scheduling)                                                                                                                                                           | `[]`                |
| `affinity`                   | Affinity for the Cryostat Pod. See: [Affinity](https://kubernetes.io/docs/reference/kubernetes-api/workload-resources/pod-v1/#scheduling)                                                                                                                                                                 | `{}`                |
| `pvc.enabled`                | Specify whether to use persistentVolumeClaim or EmptyDir storage                                                                                                                                                                                                                                          | `false`             |
| `pvc.annotations`            | Annotations to add to the persistentVolumeClaim                                                                                                                                                                                                                                                           | `{}`                |
| `pvc.storage`                | Storage size to request for the persistentVolumeClaim                                                                                                                                                                                                                                                     | `500Mi`             |
| `pvc.accessModes`            | Access mode for the persistentVolumeClaim. See: [Access Modes](https://kubernetes.io/docs/concepts/storage/persistent-volumes/#persistentvolumeclaims)                                                                                                                                                    | `["ReadWriteOnce"]` |
| `pvc.selector`               | Selector for the persistentVolumeClaim. See: [Selector](https://kubernetes.io/docs/concepts/storage/persistent-volumes/#persistentvolumeclaims)                                                                                                                                                           | `{}`                |
| `pvc.storageClassName`       | The name of the StorageClass for the persistentVolumeClaim. See: [Class](https://kubernetes.io/docs/concepts/storage/persistent-volumes/#persistentvolumeclaims)                                                                                                                                          | `undefined`         |

