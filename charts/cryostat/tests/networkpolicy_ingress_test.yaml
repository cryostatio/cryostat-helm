suite: test networkpolicy_ingress.yaml
templates:
  - networkpolicy_ingress.yaml

tests:
  - it: should do nothing if disabled
    set:
      networkPolicy.ingress.enabled: false
    asserts:
      - hasDocuments:
          count: 0

  - it: should create an internal-access policy
    asserts:
      - equal:
          path: kind
          value: NetworkPolicy
      - equal:
          path: metadata.name
          value: RELEASE-NAME-internal-ingress
      - equal:
          path: metadata.namespace
          value: NAMESPACE
      - equal:
          path: spec.podSelector
          value:
            matchLabels:
              app.kubernetes.io/instance: RELEASE-NAME
              app.kubernetes.io/name: cryostat
              app.kubernetes.io/part-of: cryostat
      - equal:
          path: spec.ingress
          value:
            - from:
              - podSelector:
                  matchLabels:
                    app.kubernetes.io/part-of: cryostat
                    app.kubernetes.io/name: cryostat
                    app.kubernetes.io/instance: RELEASE-NAME
                namespaceSelector:
                  matchLabels:
                    kubernetes.io/metadata.name: NAMESPACE
            - from:
              - namespaceSelector:
                  matchLabels:
                    policy-group.network.openshift.io/ingress: ""
