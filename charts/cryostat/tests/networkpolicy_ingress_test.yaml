suite: test networkpolicy_ingress.yaml
templates:
  - networkpolicy_ingress.yaml

tests:
  - it: should do nothing if disabled
    set:
      networkPolicy.ingress.enabled: false
    asserts:
      - hasDocuments:
          count: 0

  - it: should create an internal-access policy
    asserts:
      - equal:
          path: kind
          value: NetworkPolicy
      - equal:
          path: metadata.name
          value: RELEASE-NAME-internal-ingress
      - equal:
          path: metadata.namespace
          value: NAMESPACE
      - equal:
          path: spec.podSelector
          value:
            matchLabels:
              app.kubernetes.io/instance: RELEASE-NAME
              app.kubernetes.io/name: cryostat
      - equal:
          path: spec.ingress
          value:
            - from:
              - podSelector:
                  matchLabels:
                    app.kubernetes.io/instance: RELEASE-NAME
                    app.kubernetes.io/name: cryostat
                namespaceSelector:
                  matchLabels:
                    kubernetes.io/metadata.name: NAMESPACE
